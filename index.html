<!--
 * @Author: your name
 * @Date: 2020-12-23 20:29:27
 * @LastEditTime: 2021-02-18 20:05:56
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: /blog/index.html
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      button {
        background: none;
        border: 0;
        box-sizing: border-box;
        margin: 1em;
        padding: 1em 2em;
        box-shadow: inset 0 0 0 2px #f45e61;
        color: #f45e61;
        font-weight: 700;
        vertical-align: middle;
      }

      button::before,
      button::after {
        content: "";
        position: absolute;
        width: 100%;
        height: 100%;
        box-sizing: inherit;
      }

      .draw {
        transition: color 0.25s;
      }

      .draw::before,
      .draw::after {
        border: 2px solid transparent;
        width: 0;
        height: 0;
      }

      .draw::before {
        top: 0;
        left: 0;
      }
    </style>
  </head>
  <body>
    <button class="draw">Button</button>
    <script>
      // 并查集的实现
      const pen = "pending",
        rej = "rejected",
        res = "resolved";
      class MyPromise {
        constructor(fn) {
          this.status = pen;
          this.state = null;
          this.resolvedCallbacks = [];
          this.rejectedCallbacks = [];
          const resolve = v => {
            if (this.status !== pen) return;
            this.state = v;
            this.status = res;
            this.resolvedCallbacks.forEach(cb => cb(v));
          };
          const reject = v => {
            if (this.status !== pen) return;
            this.state = v;
            this.status = rej;
            this.rejectedCallbacks.forEach(cb => cb(v));
          };

          try {
            fn(resolve, reject);
          } catch (e) {
            reject(e);
          }
        }

        then(onResolve, onReject) {
          let promise2;
          onResolve = typeof onResolve === "function" ? onResolve : v => v;
          onReject = typeof onReject === "function" ? onReject : e => new Error(e);

          if (this.status === res)
            return new MyPromise((res, rej) => {
              try {
                let x = onResolve(this.state);
                if (x instanceof MyPromise) x.then(res, rej);
                res(x);
              } catch (e) {
                rej(e);
              }
            });

          if (this.status === rej)
            return new MyPromise((res, rej) => {
              try {
                let x = onRejected(this.state);
                if (x instanceof MyPromise) x.then(res, rej);
              } catch (e) {
                rej(e);
              }
            });

          if (this.status === pen)
            return new MyPromise((res, rej) => {
              this.resolvedCallbacks.push(v => {
                try {
                  const x = onResolve(this.state);
                  if (x instanceof MyPromise) x.then(res, rej);
                } catch (e) {
                  rej(e);
                }
              });
              this.rejectedCallbacks.push(v => {
                try {
                  const x = onReject(this.state);
                  if (x instanceof MyPromise) x.then(res, rej);
                } catch (e) {
                  rej(e);
                }
              });
            });
        }
      }

      let pro = new MyPromise((res, rej) => {
        res(111111);
      });

      pro
        .then(v => {
          console.log(v);
          return 1;
        })
        .then(v => {
          console.log(v);
          return 2;
        })
        .then(v => {
          console.log(v);
        });

      console.log("i am behand");
      const minKBitFlips = (arr, k) => {
        const n = arr.length,
          diff = new Array(n + 1).fill(0);
        let s = 0,
          ans = 0;
        for (let i = 0; i < n; i++) {
          s += diff[i];
          if ((s + arr[i]) % 2 === 0) {
            if (i + k > n) return -1;
            diff[i]++;
            diff[i + k]--;
            ans++;
            s++;
          }
        }
        return ans;
      };
      console.log(minKBitFlips([0, 0, 0, 1, 0, 1], 1));
    </script>
  </body>
</html>
